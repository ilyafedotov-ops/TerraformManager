{% if items and items|length > 0 %}
  <form
    id="reports-bulk-delete"
    class="space-y-5"
    hx-post="/ui/reports/delete-bulk"
    hx-target="#reports-table"
    hx-swap="innerHTML"
  >
    <div class="flex flex-wrap gap-3">
      <button
        type="submit"
        class="inline-flex items-center gap-2 rounded-lg bg-red-500 px-4 py-2 text-sm font-semibold text-white shadow transition hover:bg-red-400 focus:outline-none focus:ring-2 focus:ring-red-200"
        hx-confirm="Delete selected reports?"
      >
        <i class="fas fa-trash-alt text-xs"></i>
        Delete Selected
      </button>
      <button
        type="button"
        class="inline-flex items-center gap-2 rounded-lg border border-blueGray-200 bg-white px-4 py-2 text-sm font-semibold text-blueGray-600 shadow-sm transition hover:border-blue-400 hover:text-blue-600"
        onclick="(function(kind){var ids=Array.from(document.querySelectorAll('input[name=report_id]:checked')).map(function(el){return el.value;});if(!ids.length){alert('Select at least one report first.');return;}var suffix=kind==='json'?'export-json':kind==='html'?'export-html':'export-zip';window.location='/ui/reports/'+suffix+'?ids='+encodeURIComponent(ids.join(','));})('zip')"
      >
        <i class="fas fa-file-archive text-xs"></i>
        Export ZIP (All)
      </button>
      <button
        type="button"
        class="inline-flex items-center gap-2 rounded-lg border border-blueGray-200 bg-white px-4 py-2 text-sm font-semibold text-blueGray-600 shadow-sm transition hover:border-blue-400 hover:text-blue-600"
        onclick="(function(kind){var ids=Array.from(document.querySelectorAll('input[name=report_id]:checked')).map(function(el){return el.value;});if(!ids.length){alert('Select at least one report first.');return;}var suffix=kind==='json'?'export-json':kind==='html'?'export-html':'export-zip';window.location='/ui/reports/'+suffix+'?ids='+encodeURIComponent(ids.join(','));})('json')"
      >
        <i class="fas fa-code text-xs"></i>
        Export ZIP (JSON)
      </button>
      <button
        type="button"
        class="inline-flex items-center gap-2 rounded-lg border border-blueGray-200 bg-white px-4 py-2 text-sm font-semibold text-blueGray-600 shadow-sm transition hover:border-blue-400 hover:text-blue-600"
        onclick="(function(kind){var ids=Array.from(document.querySelectorAll('input[name=report_id]:checked')).map(function(el){return el.value;});if(!ids.length){alert('Select at least one report first.');return;}var suffix=kind==='json'?'export-json':kind==='html'?'export-html':'export-zip';window.location='/ui/reports/'+suffix+'?ids='+encodeURIComponent(ids.join(','));})('html')"
      >
        <i class="fas fa-file-code text-xs"></i>
        Export ZIP (HTML)
      </button>
    </div>
    <div class="tm-table-wrapper">
      <table class="tm-table">
        <thead>
          <tr>
            <th>
              <input
                type="checkbox"
                class="h-4 w-4 rounded border-blueGray-300 text-blue-600 focus:ring-blue-500"
                onclick="document.querySelectorAll('input[name=report_id]').forEach(cb => cb.checked = this.checked)"
              />
            </th>
            <th>ID</th>
            <th>Created</th>
            <th>Issues</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for it in items %}
            <tr>
              <td>
                <input
                  type="checkbox"
                  name="report_id"
                  value="{{ it.id }}"
                  class="h-4 w-4 rounded border-blueGray-300 text-blue-600 focus:ring-blue-500"
                />
              </td>
              <td>
                <a class="font-semibold text-blue-600 hover:text-blue-800" href="/ui/reports/{{ it.id }}">
                  {{ it.id }}
                </a>
              </td>
              <td class="text-sm text-blueGray-500">{{ it.created_at }}</td>
              {% set severity_counts = (it.summary.severity_counts if it.summary and it.summary.severity_counts else {}) %}
              {% set sev = 'LOW' %}
              {% if severity_counts.get('CRITICAL') %}
                {% set sev = 'CRITICAL' %}
              {% elif severity_counts.get('HIGH') %}
                {% set sev = 'HIGH' %}
              {% elif severity_counts.get('MEDIUM') %}
                {% set sev = 'MEDIUM' %}
              {% elif severity_counts.get('LOW') %}
                {% set sev = 'LOW' %}
              {% endif %}
              {% set issues_found = it.summary.issues_found if it.summary else '-' %}
              <td>
                <span class="tm-tag tm-tag-{{ sev|lower }}">
                  {{ issues_found }}
                </span>
              </td>
              <td>
                <div class="flex flex-wrap gap-2">
                  <a
                    class="inline-flex items-center gap-2 rounded-lg bg-blue-600 px-3 py-1.5 text-xs font-semibold text-white shadow transition hover:bg-blue-500"
                    href="/ui/reports/{{ it.id }}"
                  >
                    <i class="fas fa-external-link-alt text-[10px]"></i>
                    Open
                  </a>
                  <a
                    class="inline-flex items-center gap-2 rounded-lg border border-blueGray-200 px-3 py-1.5 text-xs font-semibold text-blueGray-600 shadow-sm transition hover:border-blue-400 hover:text-blue-700"
                    href="/ui/reports/{{ it.id }}/viewer"
                  >
                    <i class="fas fa-table text-[10px]"></i>
                    Viewer
                  </a>
                  <a
                    class="inline-flex items-center gap-2 rounded-lg border border-blueGray-200 px-3 py-1.5 text-xs font-semibold text-blueGray-600 shadow-sm transition hover:border-blue-400 hover:text-blue-700"
                    href="/reports/{{ it.id }}/html"
                    target="_blank"
                  >
                    <i class="fas fa-file-code text-[10px]"></i>
                    HTML
                  </a>
                  <a
                    class="inline-flex items-center gap-2 rounded-lg border border-blueGray-200 px-3 py-1.5 text-xs font-semibold text-blueGray-600 shadow-sm transition hover:border-blue-400 hover:text-blue-700"
                    href="/reports/{{ it.id }}/csv"
                  >
                    <i class="fas fa-file-csv text-[10px]"></i>
                    CSV
                  </a>
                  <form
                    class="inline-flex"
                    hx-post="/ui/reports/delete"
                    hx-target="#reports-table"
                    hx-swap="innerHTML"
                    hx-confirm="Delete this report?"
                  >
                    <input type="hidden" name="report_id" value="{{ it.id }}" />
                    <button
                      type="submit"
                      class="inline-flex items-center gap-2 rounded-lg border border-red-200 px-3 py-1.5 text-xs font-semibold text-red-500 shadow-sm transition hover:bg-red-50"
                    >
                      <i class="fas fa-trash text-[10px]"></i>
                      Delete
                    </button>
                  </form>
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </form>
{% else %}
  <div class="rounded-2xl border border-dashed border-blueGray-200 bg-blueGray-50 px-6 py-8 text-center text-sm text-blueGray-400">
    No reports yet. Run a scan to generate your first report.
  </div>
{% endif %}
