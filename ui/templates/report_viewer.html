{% extends "base.html" %}

{% block breadcrumbs %}
  <div class="text-xs font-semibold uppercase tracking-widest text-blueGray-400">
    <a class="hover:text-blue-500" href="/ui/dashboard">Home</a>
    <span class="px-2 text-blueGray-300">/</span>
    <a class="hover:text-blue-500" href="/ui/reports">Reports</a>
    <span class="px-2 text-blueGray-300">/</span>
    <span class="text-blue-500">Viewer</span>
  </div>
{% endblock %}

{% block page_header %}
  <h1 class="text-3xl font-bold leading-tight">Report Viewer</h1>
  <p class="mt-2 max-w-2xl text-sm font-medium text-blue-100">
    Filter findings by severity or rule name, group them for summaries, and export the filtered results instantly.
  </p>
{% endblock %}

{% block hero_actions %}
  <a
    href="/ui/reports/{{ report_id }}"
    class="inline-flex items-center gap-2 rounded-xl bg-white/15 px-4 py-2 text-sm font-semibold text-white transition hover:bg-white/20"
  >
    <i class="fas fa-external-link-alt text-xs"></i>
    Open Summary
  </a>
{% endblock %}

{% block content %}
  <section class="grid gap-8 lg:grid-cols-[minmax(0,360px)_minmax(0,1fr)]">
    <aside class="space-y-6">
      <article class="rounded-3xl border border-blueGray-200 bg-white p-6 shadow-xl">
        <h2 class="text-lg font-semibold text-blueGray-700">Filters</h2>
        <p class="mt-1 text-sm text-blueGray-400">Adjust filters to refine the findings list in real time.</p>
        <div class="mt-4 grid gap-4">
          <div>
            <label for="severity" class="block text-xs font-semibold uppercase tracking-wide text-blueGray-400">
              Severity
            </label>
            <select
              name="severity"
              id="severity"
              class="mt-2 w-full rounded-2xl border border-blueGray-200 bg-blueGray-50 px-4 py-3 text-blueGray-700 shadow-sm focus:border-blue-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue-200"
              hx-get="/ui/reports/{{ report_id }}/viewer/table"
              hx-target="#viewer-table"
              hx-trigger="change"
              hx-include="#severity,#ruleq,#groupBy"
            >
              <option value="">All</option>
              <option value="LOW">LOW</option>
              <option value="MEDIUM">MEDIUM</option>
              <option value="HIGH">HIGH</option>
              <option value="CRITICAL">CRITICAL</option>
            </select>
          </div>
          <div>
            <label for="ruleq" class="block text-xs font-semibold uppercase tracking-wide text-blueGray-400">
              Rule or title
            </label>
            <input
              type="text"
              id="ruleq"
              name="rule_contains"
              placeholder="e.g. AWS-S3"
              class="mt-2 w-full rounded-2xl border border-blueGray-200 bg-blueGray-50 px-4 py-3 text-blueGray-700 shadow-sm focus:border-blue-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue-200"
              hx-get="/ui/reports/{{ report_id }}/viewer/table"
              hx-target="#viewer-table"
              hx-trigger="keyup changed delay:300ms"
              hx-include="#severity,#ruleq,#groupBy"
            />
          </div>
        </div>
        <label class="mt-4 flex items-center gap-3 rounded-2xl border border-blueGray-200 bg-blueGray-50 px-4 py-3 text-sm font-semibold text-blueGray-500 shadow-sm transition hover:border-blue-300">
          <input
            type="checkbox"
            id="groupBy"
            name="group_by"
            value="rule"
            class="h-4 w-4 rounded border-blueGray-300 text-blue-600 focus:ring-blue-500"
            hx-get="/ui/reports/{{ report_id }}/viewer/table"
            hx-target="#viewer-table"
            hx-trigger="change"
            hx-include="#severity,#ruleq,#groupBy"
          />
          Group by rule
        </label>
        <p class="mt-4 rounded-2xl bg-blueGray-50/60 px-4 py-3 text-xs text-blueGray-400">
          When grouping is enabled, findings are clustered by rule with mini severity breakdowns.
        </p>
      </article>
    </aside>
    <div class="space-y-6">
      <article class="rounded-3xl border border-blueGray-200 bg-white p-6 shadow-xl">
        <div class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
          <div>
            <h2 class="text-lg font-semibold text-blueGray-700">Findings</h2>
            <p class="text-sm text-blueGray-400">Rendered in real time from the stored report.</p>
          </div>
          <div class="text-xs font-semibold uppercase tracking-widest text-blueGray-300">
            Report {{ report_id }}
          </div>
        </div>
        <div id="viewer-table" class="mt-6" hx-get="/ui/reports/{{ report_id }}/viewer/table" hx-trigger="load"></div>
      </article>
    </div>
  </section>
{% endblock %}

{% block page_actions %}
  <a
    href="/ui/reports"
    class="inline-flex items-center gap-2 rounded-lg border border-blueGray-200 bg-white px-4 py-2 text-sm font-semibold text-blueGray-600 shadow-sm transition hover:border-blue-400 hover:text-blue-700"
  >
    <i class="fas fa-arrow-left text-xs"></i>
    Back to Reports
  </a>
{% endblock %}
